---
title: "Diabetes Prediction model: NHANES data 2013-2014" 
author: "Hannah Rosenblum, James Ng, Purnima Sharma"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '2'
header-includes:
- \usepackage{fancyhdr}
- \usepackage{lipsum}
- \pagestyle{fancy}
- \fancyhead[R]{\thepage}
- \fancypagestyle{plain}{\pagestyle{fancy}}
--- 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, results = 'asis')
```

\newpage

```{r}
library(RNHANES)
library(tidyverse)
library(summarytools)
library(leaps)
library(readr)
library(caret)
library(ggplot2)
library(patchwork)
library(mgcv)
library(nlme)
```

# Introduction

This project aimed to study any association between diabetes and several covariates in participants, ages 12 and older, using NHANES data. Effort was made to build an optimal prediction model to identify key variables within the dataset for a categorical outcome of diabetes, objective being a binary classification model with supervised learning. Certain factors of special interest were any association with participant’s race, age, cholesterol and fasting glucose levels, among others. Specifically, association was assessed between diabetes and plasma fasting glucose, body mass index, blood pressure, hours of fasting, weekly workload, cholesterol, triglycerides, insulin levels, 2 hour glucose tolerance, glucose challenge  and other demographic factors such as age, gender, race, using the NHANES data for the year 2013 - 2014 from the cdc.gov website, https://wwwn.cdc.gov/nchs/nhanes/continuousnhanes/default.aspx?BeginYear=2013 . 

Motivation was provided by the fact that diabetes is one of the major leading causes of death in the United States. As stated by the CDC site's National Diabetes Statistics Report of 2020, 34.2 million Americans are diabetic, while 7.3 million were undiagnosed. With prevalence of diabetes and prediabetes on the rise, it was of interest to find factors that might affect the diabetes status. Later years post-2013 were tried for the data, however were unavailable for the variables of interest possibly due to continuing updates. 

After extracting and merging the necessary files by participant’s Id number, variables of interest were retained in a dataframe, and saved as a dataset file within the project for easy access. Gender, Race and the response variable Diabetes were converted to factors from numeric data type. Missing entries for the response of diabetes status were removed. 185 “borderline “ reported cases, 5 with “don’t know” responses and 1 with “refused” response were also removed given the small scale of these categories, which accounted for less than 2% of the data, and in order to focus on the majority of binary responses of presence or absence of diabetes. The cleaned data contained 9,578 observations of 15 variables, including the binary outcome variable diabetes.  

```{r}
data_files <- nhanes_load_data(file_name = "DIQ_H", year = "2013-2014")

data_files <- data_files %>% 
    left_join(nhanes_load_data("GLU_H", "2013-2014"), by = "SEQN") %>%
  left_join(nhanes_load_data("HDL_H", "2013-2014"), by = "SEQN") %>%
  left_join(nhanes_load_data("INS_H", "2013-2014"), by = "SEQN") %>%
  left_join(nhanes_load_data("TRIGLY_H", "2013-2014"), by = "SEQN") %>% 
  left_join(nhanes_load_data("DEMO_H", "2013-2014"), by = "SEQN") %>% 
  left_join(nhanes_load_data("BMX_H", "2013-2014"), by = "SEQN") %>% 
  left_join(nhanes_load_data("OCQ_H", "2013-2014"), by = "SEQN") %>% 
  left_join(nhanes_load_data("OGTT_H", "2013-2014"), by = "SEQN")

raw_data <- data_files %>% 
  select(SEQN, RIAGENDR, RIDAGEYR, RIDRETH3, BMXBMI, PHAFSTHR.x, OCQ180, LBDHDD, LBDLDL, LBXTR, LBXIN, LBXGLT, GTDDR1MN, GTDBL2MN, LBXGLU, DIQ010) 

raw_data <- raw_data[raw_data$DIQ010 != 3 & raw_data$DIQ010 != 7 & raw_data$DIQ010 != 9, ] %>% 
 mutate(RIAGENDR = as_factor(RIAGENDR), RIDRETH3 = as_factor(RIDRETH3), DIQ010 = as_factor(DIQ010) ) %>% 
  drop_na(DIQ010) 
 
 colnames(raw_data) <- c("ID", "gender", "age", "race", "bmi", "fasting_hrs", "workload", "hdl", "ldl", "triglyceride", "insulin", "hr2_glucose_tolerance", "glucose_challenge", "glucose_tolerance", "glucose", "diabetes") 
 
 levels(raw_data$diabetes)[1] <- "yes"
 levels(raw_data$diabetes)[2] <- "no"
```

# EDA
...

```{r}
st_options(plain.ascii = FALSE,       
           style = "rmarkdown", 
           dfSummary.silent = TRUE,        
           footnote = NA,          
           subtitle.emphasis = FALSE)      

dfSummary(raw_data[,-1], valid.col = FALSE)
```


